@using WordSearch.Domain.Entities
@inject IJSRuntime JS

<div class="answers-container">
    <h4>Found Answers</h4>
    @if (Matches.Count == 0)
    {
        <p class="no-answers">No answers found</p>
    }
    else
    {
        <ul class="answer-list" @ref="_listRef">
            @foreach (var match in Matches)
            {
                var answerKey = match.ToString();
                var isHighlighted = HighlightedAnswers.ContainsKey(answerKey);
                var highlightColor = isHighlighted ? HighlightedAnswers[answerKey] : null;

                <li id="answer-@GetSafeId(match.Word)"
                    class="answer-item @(isHighlighted ? "highlighted" : "")"
                    style="@(isHighlighted ? $"border-left-color: {highlightColor};" : "")"
                    @onclick="() => SelectAnswer(match)">
                    <span class="answer-word">@match.Word</span>
                    <span class="answer-coords">(@match.Start) to (@match.End)</span>
                </li>
            }
        </ul>
    }
</div>

@code {
    [Parameter] public List<Match> Matches { get; set; } = new();
    [Parameter] public Dictionary<string, string> HighlightedAnswers { get; set; } = new();
    [Parameter] public EventCallback<Match> OnAnswerSelected { get; set; }
    [Parameter] public string? ScrollToWord { get; set; }

    private ElementReference _listRef;
    private string? _lastScrolledWord;

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(ScrollToWord) && ScrollToWord != _lastScrolledWord)
        {
            _lastScrolledWord = ScrollToWord;
            await ScrollToAnswer(ScrollToWord);
        }
    }

    private async Task ScrollToAnswer(string word)
    {
        var safeId = GetSafeId(word);
        await JS.InvokeVoidAsync("eval", $"document.getElementById('answer-{safeId}')?.scrollIntoView({{ behavior: 'smooth', block: 'nearest' }})");
    }

    private string GetSafeId(string word) => word.Replace(" ", "-").ToLowerInvariant();

    private async Task SelectAnswer(Match match)
    {
        await OnAnswerSelected.InvokeAsync(match);
    }
}
